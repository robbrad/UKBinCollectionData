import re
import urllib.parse

import requests
from bs4 import BeautifulSoup

from uk_bin_collection.uk_bin_collection.common import *
from uk_bin_collection.uk_bin_collection.get_bin_data import AbstractGetBinDataClass


class CouncilClass(AbstractGetBinDataClass):
    def parse_data(self, page: str, **kwargs) -> dict:

        data = {"bins": []}

        headers = {
            "Origin": "https://www.nuneatonandbedworth.gov.uk/",
            "Referer": "https://www.nuneatonandbedworth.gov.uk/",
            "User-Agent": "Mozilla/5.0",
        }

        street = urllib.parse.quote_plus(kwargs.get("paon"))
        base_url = "https://www.nuneatonandbedworth.gov.uk/"
        search_query = f"directory/search?directoryID=3&showInMap=&keywords={street}&search=Search+directory"

        search_response = requests.get(base_url + search_query, headers=headers)

        if search_response.status_code == 200:
            soup = BeautifulSoup(search_response.content, "html.parser")
            street_link_tags = soup.find_all("a", class_="list__link")

            street_name = kwargs.get("paon").lower()
            matches = [
                tag for tag in street_link_tags if street_name in tag.text.lower()
            ]

            if len(matches) == 1:
                street_url = matches[0]["href"]
                full_url = base_url.rstrip("/") + street_url
                bin_data = self.get_bin_data(full_url)

                for k, v in bin_data.items():
                    for date in v:
                        dict_data = {
                            "type": k,
                            "collectionDate": datetime.strptime(
                                date, "%Y-%m-%d"
                            ).strftime(date_format),
                        }
                        data["bins"].append(dict_data)

                return data

            elif len(matches) > 1:
                Exception("Multiple street URLs found. Please refine your search.")
            else:
                Exception("Street URL not found.")
        else:
            Exception("Failed to retrieve search results.")

        return data

    def get_bin_data(self, url) -> dict:

        headers = {
            "Origin": "https://www.nuneatonandbedworth.gov.uk/",
            "Referer": "https://www.nuneatonandbedworth.gov.uk/",
            "User-Agent": "Mozilla/5.0",
        }

        bin_day_response = requests.get(url, headers=headers)

        if bin_day_response.status_code == 200:
            soup = BeautifulSoup(bin_day_response.content, "html.parser")

            download_link = soup.find("a", {"href": re.compile(r"/downloads/file")})

            if download_link:
                file_url = download_link["href"]
                filename = file_url.split("/")[-1]

                bin_data = {
                    "bin-calendar-monday-a": {
                        "Black Bin": [
                            "2025-10-06",
                            "2025-10-20",
                            "2025-11-03",
                            "2025-11-17",
                            "2025-12-01",
                            "2025-12-15",
                            "2025-12-29",
                            "2026-01-12",
                            "2026-01-26",
                            "2026-02-09",
                            "2026-02-23",
                            "2026-03-09",
                            "2026-03-23",
                            "2026-04-06",
                            "2026-04-20",
                            "2026-05-04",
                            "2026-05-18",
                            "2026-06-01",
                            "2026-06-15",
                            "2026-06-29",
                            "2026-07-13",
                            "2026-07-27",
                            "2026-08-10",
                            "2026-08-24",
                            "2026-09-07",
                            "2026-09-21",
                        ],
                        "Brown Bin": [
                            "2025-10-13",
                            "2025-10-27",
                            "2025-11-10",
                            "2025-11-24",
                            "2025-12-08",
                            "2025-12-22",
                            "2026-01-05",
                            "2026-01-19",
                            "2026-02-02",
                            "2026-02-16",
                            "2026-03-02",
                            "2026-03-16",
                            "2026-03-30",
                            "2026-04-13",
                            "2026-04-27",
                            "2026-05-11",
                            "2026-05-25",
                            "2026-06-08",
                            "2026-06-22",
                            "2026-07-06",
                            "2026-07-20",
                            "2026-08-03",
                            "2026-08-17",
                            "2026-08-31",
                            "2026-09-14",
                            "2026-09-28",
                        ],
                        "Green Bin": [
                            "2025-10-13",
                            "2025-10-27",
                            "2025-11-10",
                            "2025-11-24",
                            "2025-12-08",
                            "2025-12-22",
                            "2026-01-05",
                            "2026-02-02",
                            "2026-02-16",
                            "2026-03-02",
                            "2026-03-16",
                            "2026-03-30",
                            "2026-04-13",
                            "2026-04-27",
                            "2026-05-11",
                            "2026-05-25",
                            "2026-06-08",
                            "2026-06-22",
                            "2026-07-06",
                            "2026-07-20",
                            "2026-08-03",
                            "2026-08-17",
                            "2026-08-31",
                            "2026-09-14",
                            "2026-09-28",
                        ],
                    },
                    "bin-calendar-monday-b": {
                        "Black Bin": [
                            "2025-10-13",
                            "2025-10-27",
                            "2025-11-10",
                            "2025-11-24",
                            "2025-12-08",
                            "2025-12-22",
                            "2026-01-05",
                            "2026-01-19",
                            "2026-02-02",
                            "2026-02-16",
                            "2026-03-02",
                            "2026-03-16",
                            "2026-03-30",
                            "2026-04-13",
                            "2026-04-27",
                            "2026-05-11",
                            "2026-05-25",
                            "2026-06-08",
                            "2026-06-22",
                            "2026-07-06",
                            "2026-07-20",
                            "2026-08-03",
                            "2026-08-17",
                            "2026-08-31",
                            "2026-09-14",
                            "2026-09-28",
                        ],
                        "Brown Bin": [
                            "2025-10-06",
                            "2025-10-20",
                            "2025-11-03",
                            "2025-11-17",
                            "2025-12-01",
                            "2025-12-15",
                            "2025-12-29",
                            "2026-01-12",
                            "2026-01-26",
                            "2026-02-09",
                            "2026-02-23",
                            "2026-03-09",
                            "2026-03-23",
                            "2026-04-06",
                            "2026-04-20",
                            "2026-05-04",
                            "2026-05-18",
                            "2026-06-01",
                            "2026-06-15",
                            "2026-06-29",
                            "2026-07-13",
                            "2026-07-27",
                            "2026-08-10",
                            "2026-08-24",
                            "2026-09-07",
                            "2026-09-21",
                        ],
                        "Green Bin": [
                            "2025-10-06",
                            "2025-10-20",
                            "2025-11-03",
                            "2025-11-17",
                            "2025-12-01",
                            "2025-12-15",
                            "2025-12-29",
                            "2026-01-12",
                            "2026-02-09",
                            "2026-02-23",
                            "2026-03-09",
                            "2026-03-23",
                            "2026-04-06",
                            "2026-04-20",
                            "2026-05-04",
                            "2026-05-18",
                            "2026-06-01",
                            "2026-06-15",
                            "2026-06-29",
                            "2026-07-13",
                            "2026-07-27",
                            "2026-08-10",
                            "2026-08-24",
                            "2026-09-07",
                            "2026-09-21",
                        ],
                    },
                    "bin-calendar-tuesday-a": {
                        "Black Bin": [
                            "2025-10-07",
                            "2025-10-21",
                            "2025-11-04",
                            "2025-11-18",
                            "2025-12-02",
                            "2025-12-16",
                            "2025-12-30",
                            "2026-01-13",
                            "2026-01-27",
                            "2026-02-10",
                            "2026-02-24",
                            "2026-03-10",
                            "2026-03-24",
                            "2026-04-07",
                            "2026-04-21",
                            "2026-05-05",
                            "2026-05-19",
                            "2026-06-02",
                            "2026-06-16",
                            "2026-06-30",
                            "2026-07-14",
                            "2026-07-28",
                            "2026-08-11",
                            "2026-08-25",
                            "2026-09-08",
                            "2026-09-22",
                        ],
                        "Brown Bin": [
                            "2025-10-14",
                            "2025-10-28",
                            "2025-11-11",
                            "2025-11-25",
                            "2025-12-09",
                            "2025-12-23",
                            "2026-01-06",
                            "2026-01-20",
                            "2026-02-03",
                            "2026-02-17",
                            "2026-03-03",
                            "2026-03-17",
                            "2026-03-31",
                            "2026-04-14",
                            "2026-04-28",
                            "2026-05-12",
                            "2026-05-26",
                            "2026-06-09",
                            "2026-06-23",
                            "2026-07-07",
                            "2026-07-21",
                            "2026-08-04",
                            "2026-08-18",
                            "2026-09-01",
                            "2026-09-15",
                            "2026-09-29",
                        ],
                        "Green Bin": [
                            "2025-10-14",
                            "2025-10-28",
                            "2025-11-11",
                            "2025-11-25",
                            "2025-12-09",
                            "2025-12-23",
                            "2026-01-06",
                            "2026-02-03",
                            "2026-02-17",
                            "2026-03-03",
                            "2026-03-17",
                            "2026-03-31",
                            "2026-04-14",
                            "2026-04-28",
                            "2026-05-12",
                            "2026-05-26",
                            "2026-06-09",
                            "2026-06-23",
                            "2026-07-07",
                            "2026-07-21",
                            "2026-08-04",
                            "2026-08-18",
                            "2026-09-01",
                            "2026-09-15",
                            "2026-09-29",
                        ],
                    },
                    "bin-calendar-tuesday-b": {
                        "Black Bin": [
                            "2025-10-14",
                            "2025-10-28",
                            "2025-11-11",
                            "2025-11-25",
                            "2025-12-09",
                            "2025-12-23",
                            "2026-01-06",
                            "2026-01-20",
                            "2026-02-03",
                            "2026-02-17",
                            "2026-03-03",
                            "2026-03-17",
                            "2026-03-31",
                            "2026-04-14",
                            "2026-04-28",
                            "2026-05-12",
                            "2026-05-26",
                            "2026-06-09",
                            "2026-06-23",
                            "2026-07-07",
                            "2026-07-21",
                            "2026-08-04",
                            "2026-08-18",
                            "2026-09-01",
                            "2026-09-15",
                            "2026-09-29",
                        ],
                        "Brown Bin": [
                            "2025-10-07",
                            "2025-10-21",
                            "2025-11-04",
                            "2025-11-18",
                            "2025-12-02",
                            "2025-12-16",
                            "2025-12-30",
                            "2026-01-13",
                            "2026-01-27",
                            "2026-02-10",
                            "2026-02-24",
                            "2026-03-10",
                            "2026-03-24",
                            "2026-04-07",
                            "2026-04-21",
                            "2026-05-05",
                            "2026-05-19",
                            "2026-06-02",
                            "2026-06-16",
                            "2026-06-30",
                            "2026-07-14",
                            "2026-07-28",
                            "2026-08-11",
                            "2026-08-25",
                            "2026-09-08",
                            "2026-09-22",
                        ],
                        "Green Bin": [
                            "2025-10-07",
                            "2025-10-21",
                            "2025-11-04",
                            "2025-11-18",
                            "2025-12-02",
                            "2025-12-16",
                            "2025-12-30",
                            "2026-01-13",
                            "2026-02-10",
                            "2026-02-24",
                            "2026-03-10",
                            "2026-03-24",
                            "2026-04-07",
                            "2026-04-21",
                            "2026-05-05",
                            "2026-05-19",
                            "2026-06-02",
                            "2026-06-16",
                            "2026-06-30",
                            "2026-07-14",
                            "2026-07-28",
                            "2026-08-11",
                            "2026-08-25",
                            "2026-09-08",
                            "2026-09-22",
                        ],
                    },
                    "bin-calendar-wednesday-a": {
                        "Black Bin": [
                            "2025-10-08",
                            "2025-10-22",
                            "2025-11-05",
                            "2025-11-19",
                            "2025-12-03",
                            "2025-12-17",
                            "2025-12-31",
                            "2026-01-14",
                            "2026-01-28",
                            "2026-02-11",
                            "2026-02-25",
                            "2026-03-11",
                            "2026-03-25",
                            "2026-04-08",
                            "2026-04-22",
                            "2026-05-06",
                            "2026-05-20",
                            "2026-06-03",
                            "2026-06-17",
                            "2026-07-01",
                            "2026-07-15",
                            "2026-07-29",
                            "2026-08-12",
                            "2026-08-26",
                            "2026-09-09",
                            "2026-09-23",
                        ],
                        "Brown Bin": [
                            "2025-10-01",
                            "2025-10-15",
                            "2025-10-29",
                            "2025-11-12",
                            "2025-11-26",
                            "2025-12-10",
                            "2025-12-24",
                            "2026-01-07",
                            "2026-01-21",
                            "2026-02-04",
                            "2026-02-18",
                            "2026-03-04",
                            "2026-03-18",
                            "2026-04-01",
                            "2026-04-15",
                            "2026-04-29",
                            "2026-05-13",
                            "2026-05-27",
                            "2026-06-10",
                            "2026-06-24",
                            "2026-07-08",
                            "2026-07-22",
                            "2026-08-05",
                            "2026-08-19",
                            "2026-09-02",
                            "2026-09-16",
                            "2026-09-30",
                        ],
                        "Green Bin": [
                            "2025-10-01",
                            "2025-10-15",
                            "2025-10-29",
                            "2025-11-12",
                            "2025-11-26",
                            "2025-12-10",
                            "2025-12-24",
                            "2026-01-07",
                            "2026-02-04",
                            "2026-02-18",
                            "2026-03-04",
                            "2026-03-18",
                            "2026-04-01",
                            "2026-04-15",
                            "2026-04-29",
                            "2026-05-13",
                            "2026-05-27",
                            "2026-06-10",
                            "2026-06-24",
                            "2026-07-08",
                            "2026-07-22",
                            "2026-08-05",
                            "2026-08-19",
                            "2026-09-02",
                            "2026-09-16",
                            "2026-09-30",
                        ],
                    },
                    "bin-calendar-wednesday-b": {
                        "Black Bin": [
                            "2025-10-01",
                            "2025-10-15",
                            "2025-10-29",
                            "2025-11-12",
                            "2025-11-26",
                            "2025-12-10",
                            "2025-12-24",
                            "2026-01-07",
                            "2026-01-21",
                            "2026-02-04",
                            "2026-02-18",
                            "2026-03-04",
                            "2026-03-18",
                            "2026-04-01",
                            "2026-04-15",
                            "2026-04-29",
                            "2026-05-13",
                            "2026-05-27",
                            "2026-06-10",
                            "2026-06-24",
                            "2026-07-08",
                            "2026-07-22",
                            "2026-08-05",
                            "2026-08-19",
                            "2026-09-02",
                            "2026-09-16",
                            "2026-09-30",
                        ],
                        "Brown Bin": [
                            "2025-10-08",
                            "2025-10-22",
                            "2025-11-05",
                            "2025-11-19",
                            "2025-12-03",
                            "2025-12-17",
                            "2025-12-31",
                            "2026-01-14",
                            "2026-01-28",
                            "2026-02-11",
                            "2026-02-25",
                            "2026-03-11",
                            "2026-03-25",
                            "2026-04-08",
                            "2026-04-22",
                            "2026-05-06",
                            "2026-05-20",
                            "2026-06-03",
                            "2026-06-17",
                            "2026-07-01",
                            "2026-07-15",
                            "2026-07-29",
                            "2026-08-12",
                            "2026-08-26",
                            "2026-09-09",
                            "2026-09-23",
                        ],
                        "Green Bin": [
                            "2025-10-08",
                            "2025-10-22",
                            "2025-11-05",
                            "2025-11-19",
                            "2025-12-03",
                            "2025-12-17",
                            "2025-12-31",
                            "2026-01-14",
                            "2026-02-11",
                            "2026-02-25",
                            "2026-03-11",
                            "2026-03-25",
                            "2026-04-08",
                            "2026-04-22",
                            "2026-05-06",
                            "2026-05-20",
                            "2026-06-03",
                            "2026-06-17",
                            "2026-07-01",
                            "2026-07-15",
                            "2026-07-29",
                            "2026-08-12",
                            "2026-08-26",
                            "2026-09-09",
                            "2026-09-23",
                        ],
                    },
                    "bin-calendar-thursday-a": {
                        "Black Bin": [
                            "2025-10-09",
                            "2025-10-23",
                            "2025-11-06",
                            "2025-11-20",
                            "2025-12-04",
                            "2025-12-18",
                            "2026-01-01",
                            "2026-01-15",
                            "2026-01-29",
                            "2026-02-12",
                            "2026-02-26",
                            "2026-03-12",
                            "2026-03-26",
                            "2026-04-09",
                            "2026-04-23",
                            "2026-05-07",
                            "2026-05-21",
                            "2026-06-04",
                            "2026-06-18",
                            "2026-07-02",
                            "2026-07-16",
                            "2026-07-30",
                            "2026-08-13",
                            "2026-08-27",
                            "2026-09-10",
                            "2026-09-24",
                        ],
                        "Brown Bin": [
                            "2025-10-02",
                            "2025-10-16",
                            "2025-10-30",
                            "2025-11-13",
                            "2025-11-27",
                            "2025-12-11",
                            "2025-12-25",
                            "2026-01-08",
                            "2026-01-22",
                            "2026-02-05",
                            "2026-02-19",
                            "2026-03-05",
                            "2026-03-19",
                            "2026-04-02",
                            "2026-04-16",
                            "2026-04-30",
                            "2026-05-14",
                            "2026-05-28",
                            "2026-06-11",
                            "2026-06-25",
                            "2026-07-09",
                            "2026-07-23",
                            "2026-08-06",
                            "2026-08-20",
                            "2026-09-03",
                            "2026-09-17",
                        ],
                        "Green Bin": [
                            "2025-10-02",
                            "2025-10-16",
                            "2025-10-30",
                            "2025-11-13",
                            "2025-11-27",
                            "2025-12-11",
                            "2025-12-25",
                            "2026-01-08",
                            "2026-02-05",
                            "2026-02-19",
                            "2026-03-05",
                            "2026-03-19",
                            "2026-04-02",
                            "2026-04-16",
                            "2026-04-30",
                            "2026-05-14",
                            "2026-05-28",
                            "2026-06-11",
                            "2026-06-25",
                            "2026-07-09",
                            "2026-07-23",
                            "2026-08-06",
                            "2026-08-20",
                            "2026-09-03",
                            "2026-09-17",
                        ],
                    },
                    "bin-calendar-thursday-b": {
                        "Black Bin": [
                            "2025-10-02",
                            "2025-10-16",
                            "2025-10-30",
                            "2025-11-13",
                            "2025-11-27",
                            "2025-12-11",
                            "2025-12-25",
                            "2026-01-08",
                            "2026-01-22",
                            "2026-02-05",
                            "2026-02-19",
                            "2026-03-05",
                            "2026-03-19",
                            "2026-04-02",
                            "2026-04-16",
                            "2026-04-30",
                            "2026-05-14",
                            "2026-05-28",
                            "2026-06-11",
                            "2026-06-25",
                            "2026-07-09",
                            "2026-07-23",
                            "2026-08-06",
                            "2026-08-20",
                            "2026-09-03",
                            "2026-09-17",
                        ],
                        "Brown Bin": [
                            "2025-10-09",
                            "2025-10-23",
                            "2025-11-06",
                            "2025-11-20",
                            "2025-12-04",
                            "2025-12-18",
                            "2026-01-01",
                            "2026-01-15",
                            "2026-01-29",
                            "2026-02-12",
                            "2026-02-26",
                            "2026-03-12",
                            "2026-03-26",
                            "2026-04-09",
                            "2026-04-23",
                            "2026-05-07",
                            "2026-05-21",
                            "2026-06-04",
                            "2026-06-18",
                            "2026-07-02",
                            "2026-07-16",
                            "2026-07-30",
                            "2026-08-13",
                            "2026-08-27",
                            "2026-09-10",
                            "2026-09-24",
                        ],
                        "Green Bin": [
                            "2025-10-09",
                            "2025-10-23",
                            "2025-11-06",
                            "2025-11-20",
                            "2025-12-04",
                            "2025-12-18",
                            "2026-01-01",
                            "2026-01-15",
                            "2026-01-29",
                            "2026-02-12",
                            "2026-02-26",
                            "2026-03-12",
                            "2026-03-26",
                            "2026-04-09",
                            "2026-04-23",
                            "2026-05-07",
                            "2026-05-21",
                            "2026-06-04",
                            "2026-06-18",
                            "2026-07-02",
                            "2026-07-16",
                            "2026-07-30",
                            "2026-08-13",
                            "2026-08-27",
                            "2026-09-10",
                            "2026-09-24",
                        ],
                    },
                    "bin-calendar-friday-a": {
                        "Black Bin": [
                            "2025-10-10",
                            "2025-10-24",
                            "2025-11-07",
                            "2025-11-21",
                            "2025-12-05",
                            "2025-12-19",
                            "2026-01-02",
                            "2026-01-16",
                            "2026-01-30",
                            "2026-02-13",
                            "2026-02-27",
                            "2026-03-13",
                            "2026-03-27",
                            "2026-04-10",
                            "2026-04-24",
                            "2026-05-08",
                            "2026-05-22",
                            "2026-06-05",
                            "2026-06-19",
                            "2026-07-03",
                            "2026-07-17",
                            "2026-07-31",
                            "2026-08-14",
                            "2026-08-28",
                            "2026-09-11",
                            "2026-09-25",
                        ],
                        "Brown Bin": [
                            "2025-10-03",
                            "2025-10-17",
                            "2025-10-31",
                            "2025-11-14",
                            "2025-11-28",
                            "2025-12-12",
                            "2025-12-26",
                            "2026-01-09",
                            "2026-01-23",
                            "2026-02-06",
                            "2026-02-20",
                            "2026-03-06",
                            "2026-03-20",
                            "2026-04-03",
                            "2026-04-17",
                            "2026-05-01",
                            "2026-05-15",
                            "2026-05-29",
                            "2026-06-12",
                            "2026-06-26",
                            "2026-07-10",
                            "2026-07-24",
                            "2026-08-07",
                            "2026-08-21",
                            "2026-09-04",
                            "2026-09-18",
                        ],
                        "Green Bin": [
                            "2025-10-03",
                            "2025-10-17",
                            "2025-10-31",
                            "2025-11-14",
                            "2025-11-28",
                            "2025-12-12",
                            "2025-12-26",
                            "2026-01-09",
                            "2026-02-06",
                            "2026-02-20",
                            "2026-03-06",
                            "2026-03-20",
                            "2026-04-03",
                            "2026-04-17",
                            "2026-05-01",
                            "2026-05-15",
                            "2026-05-29",
                            "2026-06-12",
                            "2026-06-26",
                            "2026-07-10",
                            "2026-07-24",
                            "2026-08-07",
                            "2026-08-21",
                            "2026-09-04",
                            "2026-09-18",
                        ],
                    },
                    "bin-calendar-friday-b": {
                        "Black Bin": [
                            "2025-10-03",
                            "2025-10-17",
                            "2025-10-31",
                            "2025-11-14",
                            "2025-11-28",
                            "2025-12-12",
                            "2025-12-26",
                            "2026-01-09",
                            "2026-01-23",
                            "2026-02-06",
                            "2026-02-20",
                            "2026-03-06",
                            "2026-03-20",
                            "2026-04-03",
                            "2026-04-17",
                            "2026-05-01",
                            "2026-05-15",
                            "2026-05-29",
                            "2026-06-12",
                            "2026-06-26",
                            "2026-07-10",
                            "2026-07-24",
                            "2026-08-07",
                            "2026-08-21",
                            "2026-09-04",
                            "2026-09-18",
                        ],
                        "Brown Bin": [
                            "2025-10-10",
                            "2025-10-24",
                            "2025-11-07",
                            "2025-11-21",
                            "2025-12-05",
                            "2025-12-19",
                            "2026-01-02",
                            "2026-01-16",
                            "2026-01-30",
                            "2026-02-13",
                            "2026-02-27",
                            "2026-03-13",
                            "2026-03-27",
                            "2026-04-10",
                            "2026-04-24",
                            "2026-05-08",
                            "2026-05-22",
                            "2026-06-05",
                            "2026-06-19",
                            "2026-07-03",
                            "2026-07-17",
                            "2026-07-31",
                            "2026-08-14",
                            "2026-08-28",
                            "2026-09-11",
                            "2026-09-25",
                        ],
                        "Green Bin": [
                            "2025-10-10",
                            "2025-10-24",
                            "2025-11-07",
                            "2025-11-21",
                            "2025-12-05",
                            "2025-12-19",
                            "2026-01-02",
                            "2026-01-16",
                            "2026-01-30",
                            "2026-02-13",
                            "2026-02-27",
                            "2026-03-13",
                            "2026-03-27",
                            "2026-04-10",
                            "2026-04-24",
                            "2026-05-08",
                            "2026-05-22",
                            "2026-06-05",
                            "2026-06-19",
                            "2026-07-03",
                            "2026-07-17",
                            "2026-07-31",
                            "2026-08-14",
                            "2026-08-28",
                            "2026-09-11",
                            "2026-09-25",
                        ],
                    },
                }

                output = bin_data[filename]
            else:
                print(bin_day_response.content)
                Exception("Bin data Download link not found.")

        else:
            Exception("Failed to retrieve bin data.")

        return output
